<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#eeeeff">

    <title>Loading book...</title>

    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="images/icon.png">

    <script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
    <link rel="import" href="elements/elements.html">
    <link rel="import" href="styles/common.html">
    <link rel="import" href="styles/read.html">
  </head>

  <body>
    <template is="dom-bind" id="pageTemplate">
      <iron-media-query query="(max-width: 600px)"
                        query-matches="{{narrow}}">
      </iron-media-query>

      <iron-a11y-keys target="[[t.$.pageableText]]"
                      keys="left right space"
                      on-keys-pressed="keyPress">
      </iron-a11y-keys>

      <iron-ajax auto
                 url="[[bookUrl]]"
                 handle-as="text"
                 last-response="{{bookText}}">
      </iron-ajax>

      <paper-toolbar>
        <paper-icon-button icon="arrow-back"
                           on-tap="navigateToIndex">
        </paper-icon-button>

        <div id="title">[[title]]</div>

        <paper-icon-button icon="text-format"
                           on-click="openFormatDialog">
        </paper-icon-button>

        <paper-dialog id="formatDialog">
          <div>
            <h3>Theme</h3>
            <paper-radio-group selected="{{theme}}">
              <paper-radio-button name="light">Light</paper-radio-button>
              <paper-radio-button name="dark">Dark</paper-radio-button>
            </paper-radio-group>
          </div>

          <div>
            <h3>Font</h3>
            <paper-radio-group selected="{{fontFamily}}">
              <paper-radio-button name="Georgia">Georgia</paper-radio-button>
              <paper-radio-button name="Roboto">Roboto</paper-radio-button>
            </paper-radio-group>
          </div>

          <div>
            <h3>Line Spacing</h3>
            <paper-radio-group selected="{{lineHeight}}">
              <paper-radio-button name="1.0">Tight</paper-radio-button>
              <paper-radio-button name="1.2">Normal</paper-radio-button>
              <paper-radio-button name="1.5">Loose</paper-radio-button>
            </paper-radio-group>
          </div>

          <div>
            <h3>Size (%)</h3>
            <paper-slider pin
                          value="{{fontSizePercent}}"
                          min="50"
                          max="300"
                          step="10">
            </paper-slider>
          </div>
        </paper-dialog>
      </paper-toolbar>

      <pageable-text id="pageableText"
                     class$="[[theme]]"
                     column-gap="40"
                     columns="[[calculateColumns(narrow)]]"
                     font-family="[[fontFamily]]"
                     font-size="[[fontSizePercent]]%"
                     line-height="[[lineHeight]]"
                     current-page="{{currentPage}}"
                     total-pages="{{totalPages}}"
                     on-marked-render-complete="repaginate">
          <marked-element markdown="[[bookText]]"></marked-element>
      </pageable-text>

      <template is="dom-if" if="[[totalPages]]">
        <div id="bottomBar">
          <paper-slider id="pageSlider"
                        pin
                        min="1"
                        max="[[totalPages]]"
                        value="{{currentPage}}">
          </paper-slider>

          <div id="pageDisplay">
            <span>[[currentPage]]</span> / <span>[[totalPages]]</span>
          </div>

          <paper-icon-button icon="arrow-back" on-tap="previousPage"></paper-icon-button>
          <paper-icon-button icon="arrow-forward" on-tap="nextPage"></paper-icon-button>
        </div>
      </template>
    </template>

    <script src="js/read.js"></script>
    <script src="js/sw-registration.js"></script>
  </body>
</html>
