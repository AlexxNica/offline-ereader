<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="description" content="A responsive, offline eReader built with Polymer.">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <meta theme-color="#0277db">

    <title>Read</title>

    <link rel="manifest" href="manifest.json">
    <link rel="shortcut icon" href="images/icon.png">

    <script src="bower_components/platform/platform.js"></script>
    <link rel="import" href="bower_components/core-a11y-keys/core-a11y-keys.html">
    <link rel="import" href="bower_components/core-ajax/core-ajax.html">
    <link rel="import" href="bower_components/core-header-panel/core-header-panel.html">
    <link rel="import" href="bower_components/core-icon-button/core-icon-button.html">
    <link rel="import" href="bower_components/core-toolbar/core-toolbar.html">
    <link rel="import" href="bower_components/font-roboto/roboto.html">
    <link rel="import" href="bower_components/mark-down/mark-down.html">
    <link rel="import" href="bower_components/pageable-text/pageable-text.html">
    <link rel="import" href="bower_components/pageable-text/pageable-text-source-markdown.html">
    <link rel="import" href="bower_components/paper-button/paper-button.html">
    <link rel="import" href="bower_components/paper-dialog/paper-dialog.html">
    <link rel="import" href="bower_components/paper-dialog/paper-dialog-transition.html">
    <link rel="import" href="bower_components/paper-input/paper-input.html">
    <link rel="import" href="bower_components/paper-item/paper-item.html">
    <link rel="import" href="bower_components/paper-menu-button/paper-menu-button.html">
    <link rel="import" href="bower_components/paper-slider/paper-slider.html">

    <link rel="stylesheet" href="styles/common.css" shim-shadowdom>
    <link rel="stylesheet" href="styles/read.css" shim-shadowdom>
  </head>

  <body unresolved fit fullbleed>
    <template is="auto-binding" id="page-template">
      <core-a11y-keys target="{{parentElement}}"
                      keys="left right space esc"
                      on-keys-pressed="{{handleKeyPress}}">
      </core-a11y-keys>

      <core-toolbar id="topBar"
                    hidden?="{{!showToolbars}}">
        <a class="icon-button" href="index.html">
          <core-icon-button icon="arrow-back"></core-icon-button>
        </a>

        <div id="page-title" flex>Book Title</div>

        <core-icon-button icon="text-format"
                          on-tap="{{toggleFormatDialog}}">
        </core-icon-button>

        <paper-dialog id="format-dialog"
                      transition="paper-dialog-transition-center">
        </paper-dialog>
      </core-toolbar>

      <template if="{{bookUrl}}">
        <core-ajax auto
                   url="{{bookUrl}}"
                   handleAs="text"
                   response="{{markdown}}">
        </core-ajax>
      </template>

      <pageable-text id="text"
                     fit
                     columnGap="40"
                     savedProgressId="{{bookUrl}}"
                     fontFamily="{{fontFamily}}"
                     fontSize="{{fontSizePercent}}%"
                     currentPage="{{currentPage}}"
                     totalPages="{{totalPages}}"
                     on-tap="{{toggleToolbars}}">
        <pageable-text-source-markdown chapterElements="{{chapterElements}}"
                                       markdownText="{{markdown}}">
        </pageable-text-source-markdown>
      </pageable-text>

      <core-toolbar id="bottomBar"
                    layout horizontal
                    hidden?="{{!showToolbars}}">
        <paper-menu-button id="chapters-menu"
                           icon="list"
                           noTransition="true"
                           halign="left"
                           valign="bottom">
          <template repeat="{{chapterElement in chapterElements}}">
            <paper-item on-tap="{{jumpToChapter}}">{{chapterElement.textContent}}</paper-item>
          </template>
        </paper-menu-button>

        <paper-slider id="page-slider"
                      flex
                      pin="true"
                      min="1"
                      max="{{totalPages}}"
                      immediateValue="{{currentPage}}">
        </paper-slider>

        <div id="page-display">
          {{currentPage}}/{{totalPages}}
        </div>
      </core-toolbar>

      <core-animation id="toolbar-animation"
                      duration="150"
                      fill="both"
                      on-core-animation-finish="{{finishToolbarAnimation}}">
        <core-animation-keyframe>
          <core-animation-prop name="opacity" value="1"></core-animation-prop>
        </core-animation-keyframe>
        <core-animation-keyframe>
          <core-animation-prop name="opacity" value="0"></core-animation-prop>
        </core-animation-keyframe>
      </core-animation>
    </template>

    <script src="js/read.js"></script>
  </body>
</html>
